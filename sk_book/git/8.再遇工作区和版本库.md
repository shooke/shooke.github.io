---
title: 8.再遇工作区和版本库
categories:
  - 一点一点了解git
tags:
  - git
date: 2019-12-17 14:56:10
---
## 小白的故事

> 本故事纯属虚构，如有雷同，^0^那可太巧了

小白正在开心的写代码，刚刚完成了产品小伙伴的一个需求。还是小有成就感的，正准备起来活动活动喝杯水。谁知产品小伙伴有风风火火的跑过来。
“小白，小白，客户还是感觉以前的交互方式用着顺手。让把功能改回去”。产品小伙伴喊道。
听到这个消息，小白满脸的黑线。废了半天劲做出来的功能再改回去。这太坑了吧。
但是没办法，谁叫客户就是上帝呢，改吧。
开始撤销，`ctrl z`。。。
what，没法撤销了？编辑器撤销的步骤有限，这可如何是好啊，难道要手动改代码？这也太悲剧了吧。
“对了找大神问一下，看git有没有办法回退”小白灵光一闪想起来老鸟。

老鸟一听到小白喊他“大神”，瞬间心情舒畅跑过来知道小白。

“你是要回退以前的版本吗？”老鸟问道。
“恩恩”小白点头
“回退其实很简单，看我操作，要记住啊”说完，做到小白的坐位上开始了他的神操作。

“首先用`git log`看一下你的提交记录”，老鸟说道
```
$ git log

Author: shooke <xingjiehu@163.com>
Date:   Sat Mar 14 16:45:03 2020 +0800

    <E7><8A><B6><E6><80><81><E4><BF><AE><E6><94><B9><E5><92><8C><E5><AF><B9><E6><AF><94><E6><97><B6><E9><97><B4>

commit 3e14b6822063c7add663cd79756e77818e821819
Author: shooke <xingjiehu@163.com>
Date:   Sat Mar 14 00:30:27 2020 +0800

    <E5><AE><A1><E6><A0><B8><E7><8A><B6><E6><80><81><E4><BF><AE><E6><94><B9>

```
“咦，你这里git log居然乱码啊”，老鸟说道
“这是咋回事啊”，小白疑惑
“好办，编码问题解决一下就可以了”。老鸟输入了如下三条命令
```
git config --global i18n.commitencoding utf-8

git config --global i18n.logoutputencoding utf-8

export LESSCHARSET=utf-8 

```
再次执行`git log`果然好了
```
git log
commit 6531ff6013dd490f60bcd646ca01df61a1ecc8b1 (HEAD -> dev, origin/master, origin/dev, origin/HEAD, master)
Author: shooke <xingjiehu@163.com>
Date:   Sat Mar 14 16:45:03 2020 +0800

    状态修改和对比时间

commit 3e14b6822063c7add663cd79756e77818e821819
Author: shooke <xingjiehu@163.com>
Date:   Sat Mar 14 00:30:27 2020 +0800

    审核状态修改

...
```
"log记录有时候很多，你可以不停的按`j`和`k`来实现向下或向上查看内容，不行看了，就输入`:q`退出。就跟vim编辑器使用方式一样"老鸟说。

"想要退回到那里，用`git reset`会退到对应的commit就可以了。比如会退到`审核状态修改`。老鸟边说变执行命令
```
git reset --hard 3e14b6822063c
```
打开编辑器，小白发现，代码真的回到以前了。

“代码真的回去了，大神你真厉害”，小白激动说道，但是马上就高高兴不起来了，因为老鸟回退的不是他想要的，他只想回退上一个操作，但是老鸟回退了两条commit。

“不用担心，再找回来便是”老鸟胸有成竹的说道
```
git reset --hard 6531ff6013dd490f60bcd
```
重新打开编辑器，小白发现代码真的找回来了。

“大神，代码不是被撤回了吗，怎么还可以再找回来啊”，小白疑惑问道。在小白的认知里，回退来就找不回来了。

“git的历史长河中，可以任意遨游的，可以时光倒流也可以时光前进。只要你知道commit 的id就可以任意切换。”老鸟神秘兮兮的说道。

“如果不知道commit id，就无法撤销了吗”小白问道
“当然不是，你可以用`HEAD^`,`git reset HEAD^`，这样就可以回退一条记录。如果多条可以加多个`^`或者用`～n`的形式，比如``git reset HEAD~5`。老鸟说

“另外，你有没有看到我用了`--hard`参数，这个参数是相当霸气的，重置stage区和工作目录，这也是为什么你看到文件内容变了。除了`hard`还有另外两个参数。咱们看看他们的区别”。老鸟说道

“为了方便演示，我先改个文件，然后做几条记录”，老鸟开始操作




## 小结
1. 解决乱码
`git config --global i18n.commitencoding utf-8`  该命令表示提交命令的时候使用utf-8编码集提交

`git config --global i18n.logoutputencoding utf-8` 该命令表示日志输出时使用utf-8编码集显示

`export LESSCHARSET=utf-8` 设置LESS字符集为utf-8，为了让配置一直有效，可以把这个设置添加到`~/.bashrc`,然后执行`source ~/.bashrc`
2. 查看历史
`git log`可以查看历史。但是如果用`git reset`回退了，是看不到被退回的历史的，如果要保证历史，可以使用`git revert`，后面会讲这个命令
3. 历史切换
`git reset HEAD^`可以向前撤销一次，多个`^`可以撤销多条历史，或者使用`git reset HEAD~5`这样可以一次撤销5条历史
`git reset`可以任意切换到某个历史，使用`git reset --hard commitid`即可，commit id不一定要全的，可以只写前几位
参数：
  1. `--hard` 重置stage区和工作目录
  2. `--mixed` 保留工作目录，并清空暂存区，执行`git checkout <file>`可撤销修改
  3. `--soft` 保留工作目录，并把重置 HEAD 所带来的新的差异放进暂存区。如果要撤回需要先执行`git reset HEAD <file>`撤销暂存区，然后执行`git checkout <file>` 撤销修改
